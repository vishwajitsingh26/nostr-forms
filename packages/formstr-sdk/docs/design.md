Formstr sdk is the tooling designed on top of the nostr protocol to help create forms that can be embedded into any website, software or usecase. This document outlines the basic api and functionality of the sdk.

## API

### Creating a formstr Instance

Create a formstr SDK instance using:

```js
let formstrSDK = formstr.getInstance(userPrivateKey);
```

- userPrivateKey(optional): is a nostr private key, you can use an existing nostr private key, or generate a new one using the `nostr-tools` `generatePrivateKey` function.

If the userPrivateKey is not provided the sdk will attempt to use the `window.nostr` functionality as outlined in [NIP-07](https://github.com/nostr-protocol/nips/blob/master/07.md)

### Create a form

a form can be created using the `createForm` function on the instance like:

```js
let formCredentials = formstrSDK.createForm(formSpec);
```

formspec: A form object that holds the information, example spec:

```json
{
  "schemaVersion": "<link to schema>",
  "name": "Pets Survey",
  "description": "A survey about your pets",
  "settings": {
    "selfSignForms": false
  },
  "fields": [
    {
      "question": "What is the name of your pet?",
      "answerType": "string"
    },
    {
      "question": "wHAT DO YOU LOVE ABOUT YOUR PET?",
      "answerType": "text"
    },
    {
      "question": "What animal is your pet? ",
      "answerType": "singleChoice",
      "choices": [
        {
          "message": "cat"
        },
        {
          "message": "dog"
        },
        {
          "message": "other",
          "otherMessage": true
        }
      ]
    },
    {
      "question": "Now we need to know about your history with pets.\nallergies, what kinds of pet you had as a child",
      "answerType": "label"
    },
    {
      "question": "How long have you owned a pet for?",
      "answerType": "number",
      "numberConstraints": {
        "max": 50,
        "min": 0
      }
    }
  ]
}
```

### View Past Forms

```js
let pastForms = formstrSDK.getPastForms();
```

uses user private key(or nip-07) to fetch past forms, the pastForms array looks like

```json
[
  {
    "formLink": "https://formstr.app/#/forms/:form_id",
    "formId": "sfwsafsaf",
    "formSecret": "dsfsdfsafsdf..."
  },
  ...
]
```

### Save form to nostr

All forms are backed up to nostr automatically with the private key/nip-07 used to initialize the client, but if a user wants to save a form manually, they can do:

```js
formstrSDK.saveForm(formPrivateKey);
```

this method does not return anything

### Fetch a form

```js
let form = await formstrSDK.fetchFormTemplate(formId);
```

the form object looks like:

```json
{
  "name": "Pets Survey",
  "description": "A survey about your pets",
  "settings": {
    "selfSignForms": false
  },
  "fields": [
    {
      "question": "What is the name of your pet?",
      "answerType": "string",
      "questionId": "bkcApM"
    },
    {
      "question": "wHAT DO YOU LOVE ABOUT YOUR PET?",
      "answerType": "text",
      "questionId": "UYOqdD"
    },
    {
      "question": "What animal is your pet? ",
      "answerType": "singleChoice",
      "questionId": "ntEuAS",
      "choices": [
        {
          "message": "cat",
          "choiceId": "0BH7EH"
        },
        {
          "message": "dog",
          "choiceId": "ZlbUkA"
        },
        {
          "message": "other",
          "choiceId": "71F86j",
          "other": true
        }
      ]
    },
    {
      "question": "Now we need to know about your history with pets.\nallergies, what kinds of pet you had as a child",
      "answerType": "label",
      "questionId": "uv9dDR"
    },
    {
      "question": "How long have you owned a pet for?",
      "answerType": "number",
      "questionId": "zzK4i2",
      "numberConstraints": {
        "max": 50,
        "min": 0
      }
    }
  ]
}

Here the ids are generated by the sdk and stored on the relays, the Id's can be used for identifying a question or choices.
```

### Fill an existing form

```js
formstrSDK.sendResponse(responses, anonymousResponse, senderPrivateKey);
```

- responses(required): is an array of questionIds and their corresponding answers:

```json
[
  {
    "questiondId": "bkcApM",
    "answer": "jerry"
  },
  {
    "questionId": "UYOqdD",
    "answer": "it annoys tom"
  },
  {
    "questionId": "ntEuAS",
    "answer": "71F86j",
    "otherMessage": "mouse"
  },
  {
    "questionId": "zzK4i2",
    "answer": 10
  }
]
```

- anonymousResponse(optional, default: false): is a boolean flag telling the sdk to send the response anonymously

- senderPrivateKey(optional): private key of the person filling the form, if anonymousResponse is false and senderPrivateKey is not provided, the sdk will fallback to the `window.nostr` object from NIP-07.

### View form responses

```js
responses = formstrSDK.viewResponses(formSecret);
```

responses: An array of responses, with user information.

looks like:

```json
[
  {
    "userProfile": {
      "name": "formsUser",
      "pubkey": "npubabc..."
    },
    "response": [
      {
        "question": "What is the name of your pet?",
        "questionId": "bkcApM",
        "answerType": "string",
        "answer": "jerry"
      },
      {
        "question": "wHAT DO YOU LOVE ABOUT YOUR PET?",
        "questionId": "UYOqdD",
        "answerType": "text",
        "answer": "it annoys tom"
      },
      {
        "question": "What animal is your pet? ",
        "questionId": "ntEuAS",
        "answerType": "singleChoice",
        "answer": "71F86j",
        "otherMessage": "mouse"
      },
      {
        "question": "How long have you owned a pet for?",
        "questionId": "zzK4i2",
        "answerType": "number",
        "answer": "10"
      }
    ]
  }
]
```
